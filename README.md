# WebAR 粒子互动系统 & 圣诞树交互系统 & 星球粒子系统

这是一个基于 Three.js 和 MediaPipe Hands 的 WebAR 互动应用集合，包含三个完整的3D交互体验：粒子系统、圣诞树系统和星球粒子系统。
### 在线体验
GitHub Pages 部署版本：
- 粒子系统：https://JasonWuyaocheng.github.io/web-ar-particle-system/WebARParticleSystem.html
- 星球粒子系统：https://JasonWuyaocheng.github.io/web-ar-particle-system/WebARPlanetParticles.html
- 圣诞树系统：https://JasonWuyaocheng.github.io/web-ar-particle-system/WebARChristmasTree.html

```
**如果你在 GitHub Pages 上遇到 `ERR_BLOCKED_BY_CLIENT` 或页面无法加载**，请使用以下**完全离线版本**：

## ⚡ 立即解决方案（推荐）

### 方法 1：使用完全离线版
1. 下载所有文件到本地
2. 使用这个文件：`WebARPlanetParticles_Offline.html`
3. 它包含所有本地依赖，无需CDN

### 方法 2：本地快速测试
```bash
# 下载项目后
cd web-ar-particle-system
python -m http.server 8080
# 访问 http://localhost:8080/WebARPlanetParticles_Offline.html
```

### 方法 3：无痕模式测试
- Chrome: `Ctrl+Shift+N`
- Firefox: `Ctrl+Shift+P`
- 这会禁用浏览器扩展，避免资源被阻止

## 📋 完整部署指南
详细步骤请查看：
- `DEPLOYMENT_CHECKLIST.md` - 完整部署清单
- `README_GitHub_Pages.md` - GitHub Pages 专用指南

## ✅ 部署状态

- ✅ 所有文件已上传到 GitHub
- ✅ 完全离线版本已设置为 index.html
- ✅ 本地依赖库已下载并配置
- ✅ README 已更新，包含详细部署指南
- ✅ 错误修复指南已添加
---

## 🌟 核心功能

### 粒子互动系统 (WebARParticleSystem.html) ⭐ **全新优化**
- **16,000个青色流体粒子**：高性能Fibonacci球面分布算法
- **超小粒子尺寸**：0.04（原0.08，减小50%）- 大胆精细的圆形小球
- **物理引擎**：基于速度+加速度的真实物理模型
- **五态手势识别**：
  - 张手 → 球形变换
  - 剪刀手 → "我是 Mok" 文字展示
  - 握拳 → 圆环形态
  - 食指 → 星形图案
  - 竖大拇指 → 爱心形状
- **交互特效**：
  - 手势切换爆炸过渡效果
  - 挥手风暴（快速挥动手掌可吹散粒子）
  - 深度推拉反馈（根据手掌大小实时缩放粒子系统）

### 星球粒子系统 (WebARPlanetParticles.html) ⭐ **全新优化**
- **橙色星球核心**：4,000个橙色粒子构成绚烂星球（半径8-10）
- **白色星环**：3,000个白色粒子环绕星球（双环结构：14-18和22-26）
- **粒子尺寸**：星球粒子0.8-2.3，星环粒子0.6（**清晰球形**）
- **新增调试功能**：
  - **摄像头预览**：可选的实时摄像头显示（160x120px，镜像）
  - **状态指示器**：实时显示系统状态、手势识别结果
  - **错误诊断**：明确提示权限问题和初始化状态
- **性能优化**：
  - **纹理缓存**：避免重复创建Canvas纹理
  - **内存优化**：预分配粒子数组，减少垃圾回收
  - **智能启动**：100ms延迟确保资源稳定
  - **FPS监控**：实时性能显示
- **手势控制**（**完全保留原始逻辑**）：
  - **旋转手掌**：同步旋转星球（灵敏度3.0倍）
  - **握拳 + 远离**：快速拉远镜头（先慢后快）
  - **张开 + 靠近**：快速拉近镜头（先快后慢）
  - **距离范围**：15-150单位，平滑过渡（系数0.08）
- **视觉特效**：
  - 背景雾效 - 增加深邃感
  - 粒子自转 - 星球(0.002)和星环(-0.001)独立旋转
  - 自动旋转模式 - 手势丢失时启用
  - 实时UI提示 - 手势图标和操作说明
- **技术实现**：
  - **MediaPipe Hands** 1只手检测（原始算法）
  - 640x480摄像头分辨率
  - 复杂度模型1，置信度0.5
  - 实时加载提示和错误降级
  - **调试模式**：点击"🔍 调试摄像头"查看实时画面

### 圣诞树互动系统 (WebARChristmasTree.html)
- **3D圣诞树构建**：30个球体 + 20个立方体 + 15个糖果棍 + 10个照片位
- **三态状态管理**：
  - 合拢态：圣诞树成形（圆锥排列）
  - 散开态：元素漂浮（随机分布）
  - 照片放大态：选中照片放大展示
- **手势控制**：
  - 握拳 → 合拢态
  - 五指张开 → 散开态
  - 抓取 → 选择最近照片并放大
  - 旋转手势 → 相机旋转
- **照片管理**：支持上传、管理、删除照片
- **C键快捷键**：显示/隐藏摄像头画面

## 🎨 全新UI设计（玻璃拟态）

### 统一界面特性
- **玻璃拟态设计**：毛玻璃效果 + 金属质感边框
- **辉光背景**：动态脉冲效果的渐变辉光
- **专业面板系统**：
  - 左侧状态面板（实时显示状态、手势、照片数量、FPS）
  - 右侧手势指示器（图标+文字+颜色编码）
  - 顶部操作按钮（全屏、UI隐藏、帮助）
  - 底部控制面板（状态切换、自动旋转、重置、辉光开关）
  - 右侧上传面板（上传照片、管理照片）

### 交互增强
- **拖拽标题**：可拖动主标题到任意位置
- **键盘快捷键**：
  - `1/2/3`：切换状态（圣诞树）
  - `空格`：循环切换 / 自动旋转（星球）
  - `F`：全屏切换
  - `H`：UI隐藏/显示
  - `C`：摄像头显示/隐藏（圣诞树）
- **UI隐藏/显示**：一键隐藏/显示所有界面元素
- **照片管理器**：网格视图 + 删除功能

## 🔧 技术栈

- **Three.js** - 3D 图形渲染库 (v0.160.0)
- **MediaPipe Hands** - 手势识别 (v0.4.1646424915)
- **后期处理** - UnrealBloomPass 辉光效果
- **WebGL** - GPU 加速图形渲染
- **CDN** - unpkg + jsdelivr 双源加载

## 🚀 运行方式

### 本地运行（推荐）

由于浏览器安全策略限制，需要通过本地服务器运行：

#### 方法一：Python
```bash
# Python 3.x
python -m http.server 8000

# Python 2.x
python -m SimpleHTTPServer 8000
```

#### 方法二：Node.js
```bash
# 安装 http-server
npm install -g http-server

# 启动服务器
http-server -p 8000
```

#### 方法三：VS Code Live Server
安装 "Live Server" 扩展，右键HTML文件选择 "Open with Live Server"

#### 访问地址
启动后访问：
- 粒子系统：http://localhost:8000/WebARParticleSystem.html
- 星球粒子系统：http://localhost:8000/WebARPlanetParticles.html
- 圣诞树系统：http://localhost:8000/WebARChristmasTree.html

### 在线体验
GitHub Pages 部署版本：
- 粒子系统：https://JasonWuyaocheng.github.io/web-ar-particle-system/WebARParticleSystem.html
- 星球粒子系统：https://JasonWuyaocheng.github.io/web-ar-particle-system/WebARPlanetParticles.html
- 圣诞树系统：https://JasonWuyaocheng.github.io/web-ar-particle-system/WebARChristmasTree.html

## 📱 使用说明

### 通用操作
1. **允许摄像头权限**：首次访问需要点击"允许"授权摄像头
2. **手势操作**：将手掌放置在摄像头前，保持适当距离（30-60cm）
3. **状态提示**：观察顶部状态指示器了解当前状态
4. **自动模式**：如果摄像头不可用，系统会自动进入演示模式

### 粒子系统专属
- **张手**：显示球形粒子阵列
- **剪刀手**：显示"Mok"文字形状
- **握拳**：显示圆环形态
- **食指**：显示星形图案
- **竖大拇指**：显示爱心形状
- **快速挥手**：触发风暴效果

### 星球粒子系统专属
- **握拳**：相机靠近星球（先快后慢）
- **张手**：相机远离星球（先慢后慢）
- **挥手**：左右挥动旋转星球
- **控制按钮**：
  - 🔄 重置相机：回到默认距离和角度
  - 🌀 自动旋转：启用/禁用自动旋转
  - ⭐ 星环发光：控制星环亮度
  - 💓 星球脉动：控制星球表面脉动
  - 🌟 切换粒子密度：高密度/标准密度

### 圣诞树系统专属
- **照片上传**：点击"上传照片"按钮选择本地图片（最多10张）
- **照片管理**：点击"管理照片"查看、选择、删除照片
- **抓取手势**：在散开态下，抓取动作会自动选择最近的照片并放大
- **相机旋转**：在散开态下，移动手部可旋转视角
- **C键功能**：显示/隐藏摄像头画面

## ⌨️ 键盘快捷键

### 通用快捷键
- `F`：全屏切换（所有系统）
- `H`：显示/隐藏界面（所有系统）

### 圣诞树系统专属
- `1`：切换到合拢态
- `2`：切换到散开态
- `3`：切换到照片放大态（需有照片）
- `空格`：循环切换状态
- `C`：显示/隐藏摄像头画面
- `Z`：照片自动轮播
- `↑↓←→`：手动旋转相机

### 星球粒子系统专属
- `空格`：自动旋转开关

### 粒子系统专属
- `1-5`：直接切换到对应手势形态
- `空格`：暂停/恢复动画
- `R`：重置所有粒子

## 🛠️ 性能优化

### 粒子系统
- **粒子尺寸优化**：从0.2降至0.04，大胆减小50%，呈现细腻圆形小球
- **Fibonacci球面分布**：避免粒子聚集，保证均匀分布
- **批量更新**：每帧只更新1/2粒子，提高性能
- **几何体复用**：使用BufferGeometry减少内存占用

### 星球粒子系统
- **粒子分布优化**：球面(4,000) + 双环(3,000)均匀分布
- **粒子尺寸**：星球0.8-2.3，星环0.6，保持清晰球形
- **物理引擎优化**：限制时间步长，避免极端值
- **平滑插值**：相机移动使用0.08系数平滑过渡
- **独立动画**：星球(0.002)和星环(-0.001)自转
- **特效可开关**：背景雾效、自动旋转、UI提示
- **手势灵敏度**：旋转3.0倍，距离控制先快后慢/先慢后快

### 圣诞树系统
- **后期处理控制**：可开关辉光效果
- **动画因子**：根据不同状态调整动画强度
- **纹理管理**：使用dispose()及时释放资源

### 通用优化
- **FPS监控**：实时显示帧率，超过60FPS自动优化
- **内存管理**：照片上传前检查尺寸，过大则压缩
- **错误降级**：摄像头失败自动切换到自动循环模式

### 🆕 星球粒子系统专项优化 (v4.1.0)
- **性能提升**：
  - **纹理缓存**：单例模式避免重复创建Canvas纹理
  - **内存优化**：预分配Float32Array数组，减少垃圾回收
  - **智能启动**：100ms延迟确保DOM稳定
  - **FPS监控**：实时性能显示
- **调试诊断**：
  - **一键调试开关**：点击"🔍 调试摄像头"查看实时画面
  - **状态指示器**：实时显示系统状态、手势识别结果
  - **错误诊断**：明确提示权限问题和初始化状态
  - **资源管理**：页面关闭时自动清理摄像头流
- **手势识别修复**：
  - **完全恢复原始逻辑**：使用最初的工作代码作为基础
  - **增强错误处理**：添加详细的调试信息和状态显示
  - **实时反馈**：显示握拳/张开状态和距离值
  - **颜色编码**：绿色=正常，黄色=等待，红色=错误

## 📋 系统要求

### 浏览器兼容性
- **支持**：Chrome 90+, Firefox 88+, Edge 90+, Safari 14+
- **需要**：WebGL 支持、摄像头访问权限
- **推荐**：使用现代浏览器以获得最佳性能

### 硬件要求
- **CPU**：建议双核以上
- **内存**：至少 2GB RAM
- **摄像头**：720p 或更高分辨率
- **网络**：首次加载需要下载依赖库（约 5MB）

### 环境要求
- **HTTPS** 或 **localhost**：由于浏览器安全策略，必须在安全环境下运行
- **本地开发**：使用本地服务器（不能直接双击HTML文件）

## 🔍 故障排除

### 常见问题
1. **摄像头无法启动**
   - 检查浏览器权限设置
   - 确保没有其他应用占用摄像头
   - 尝试刷新页面

2. **手势识别不准确**
   - 确保光线充足
   - 手掌正对摄像头
   - 保持适当距离（30-60cm）

3. **性能问题**
   - 关闭辉光效果（点击"✨ 辉光"按钮）
   - 减少照片数量
   - 降低浏览器其他标签页占用

4. **库加载失败**
   - 检查网络连接
   - 刷新页面重新加载
   - 如果CDN不稳定，可下载本地库文件

### 调试信息
- 打开浏览器控制台查看详细日志
- 观察FPS指标了解性能状况
- 使用"隐藏UI"功能查看纯净3D场景

## 📁 文件结构

```
web-ar-particle-system/
├── WebARParticleSystem.html    # 粒子互动系统（16,000粒子，0.04尺寸）⭐
├── WebARPlanetParticles.html   # 星球粒子系统（7,000粒子，0.8-2.3/0.6尺寸）
├── WebARChristmasTree.html      # 圣诞树互动系统（C键快捷键）
├── README.md                    # 项目文档
└── screenshots/                 # 截图（可选）
```

## 🎨 设计亮点

### 视觉设计
- **玻璃拟态**：现代感十足的UI设计，半透明磨砂效果
- **金属质感**：金色边框和装饰，高端大气
- **动态辉光**：背景脉冲动画，营造氛围
- **颜色编码**：不同状态使用不同主色调（金/绿/红/橙）

### 交互设计
- **多模态控制**：手势 + 按钮 + 键盘 + 拖拽
- **即时反馈**：所有操作都有视觉和文字提示
- **状态可视化**：实时显示系统状态和性能指标
- **容错设计**：摄像头失败时自动降级到演示模式

### 用户体验
- **零配置**：开箱即用，无需安装
- **响应式**：适配桌面和移动端
- **帮助系统**：内置详细使用说明
- **性能优先**：流畅的60FPS体验

## 🤝 贡献指南

欢迎贡献代码、报告bug或提出建议！

### 开发环境
```bash
# 克隆项目
git clone https://github.com/JasonWuyaocheng/web-ar-particle-system.git

# 启动本地服务器
cd web-ar-particle-system
python -m http.server 8000
```

### 提交规范
- 功能新增：`feat: 添加新功能`
- Bug修复：`fix: 修复bug`
- 文档更新：`docs: 更新文档`

## 📄 许可证

MIT License - 可自由使用、修改和分发

## 🙏 致谢

- **Three.js** - 强大的3D图形库
- **MediaPipe** - 优秀的手势识别方案
- **unpkg/jsdelivr** - 稳定的CDN服务
- **[christmas-tree](https://github.com/mtzfbdsg-sys/christmas-tree)** - 参考的开源项目，提供了圣诞树交互系统的灵感和基础实现思路

### 📚 参考来源

本项目中的圣诞树互动系统（WebARChristmasTree.html）参考了开源项目 **[mtzfbdsg-sys/christmas-tree](https://github.com/mtzfbdsg-sys/christmas-tree)** 的实现思路，并在此基础上进行了以下改进和扩展：

- 基于Three.js的3D场景构建
- 手势识别交互逻辑
- 状态管理系统设计
- 照片上传与管理功能
- UI界面优化与玻璃拟态设计
- 键盘快捷键系统
- 性能优化与错误降级处理

原始项目提供了核心的3D圣诞树构建和基础交互框架，本项目在其基础上添加了完整的WebAR手势控制、增强的UI系统、照片管理、性能优化等特性，并扩展为包含粒子系统和星球粒子系统的完整WebAR互动应用集合。+++++++ REPLACE

---

**开发时间**：2025年12月  
**版本**：4.0.0 - 粒子尺寸优化版  
**状态**：✅ 生产环境就绪

### 🆕 v4.0.0 更新内容
- **优化**：粒子系统粒子尺寸从0.08减小到0.04（减小50%）
- **优化**：星球粒子系统粒子尺寸从0.08减小到0.04（减小50%）
- **新增**：星球系统粒子密度切换功能
- **特性**：确保所有粒子为清晰的圆形小球形状
- **视觉**：更细腻、更精致的粒子视觉效果

### 📊 系统参数对比
| 系统 | 粒子数量 | 粒子尺寸 | 分布方式 | 特效特性 |
|------|----------|----------|----------|----------|
| 粒子系统 | 16,000 | **0.04** | Fibonacci球面 | 物理引擎、手势五态 |
| 星球核心 | 4,000 | **0.8-2.3** | 球面分布(8-10半径) | 自转(0.002)、橙色 |
| 星球星环 | 3,000 | **0.6** | 双环结构(14-18,22-26) | 自转(-0.001)、白色 |

如遇问题，请检查控制台错误信息或参考故障排除章节。

